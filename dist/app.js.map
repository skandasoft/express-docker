{"version":3,"sources":["../src/app.ts"],"names":["dotenv","config","app","process","env","NODE_ENV","reloadify","require","__dirname","logger","info","use","port","PORT","set","path","join","express","static","skip","req","res","statusCode","stream","fs","createWriteStream","flags","stdout","dogs","error","next","headersSent","youch","Youch","toHTML","then","html","status","send","listen","LOG_LEVEL"],"mappings":";;;;;;;AAAA;;AAGA;;AAEA;;AAEA;;AAEA;;AACA;;AAEA;;AAeA;;AAyCA;;;;;;AAvDAA,MAAM,CAACC,MAAP,G,CAEA;;AAEA,IAAMC,GAAG,GAAG,uBAAZ;eACeA,G;;;AAEf,IAAIC,OAAO,CAACC,GAAR,CAAYC,QAAZ,KAAyB,YAA7B,EAA2C;AAC1C,MAAMC,SAAS,GAAGC,OAAO,CAAC,uBAAD,CAAP,CAAiCC,SAAjC,CAAlB;;AACAC,kBAAOC,IAAP,CAAY,aAAaF,SAAzB;;AACAN,EAAAA,GAAG,CAACS,GAAJ,CAAQL,SAAR;AACA,C,CAED;;;AAGA,IAAMM,IAAI,GAAGT,OAAO,CAACC,GAAR,CAAYS,IAAZ,IAAoB,IAAjC;AACAX,GAAG,CAACY,GAAJ,CAAQ,aAAR,EAAuB,KAAvB;AACAZ,GAAG,CAACY,GAAJ,CAAQ,OAAR,EAAiBC,IAAI,CAACC,IAAL,CAAUR,SAAV,EAAqB,QAArB,CAAjB;AACAN,GAAG,CAACS,GAAJ,CAAQM,iBAAQC,MAAR,CAAe,QAAf,CAAR;AAEAhB,GAAG,CAACS,GAAJ,CAAQ,4BAAR,E,CAEA;;AACAT,GAAG,CAACS,GAAJ,CACC,qBAAO,KAAP,EAAc;AACbQ,EAAAA,IAAI,EAAE,cAAUC,GAAV,EAAeC,GAAf,EAAoB;AACzB,WAAOA,GAAG,CAACC,UAAJ,GAAiB,GAAxB;AACA;AAHY,CAAd,CADD,E,CAQA;;AACApB,GAAG,CAACS,GAAJ,CACC,qBAAO,UAAP,EAAmB;AAClBY,EAAAA,MAAM,EAAEC,EAAE,CAACC,iBAAH,CAAqBV,IAAI,CAACC,IAAL,CAAUR,SAAV,EAAqB,oBAArB,CAArB,EAAiE;AAAEkB,IAAAA,KAAK,EAAE;AAAT,GAAjE;AADU,CAAnB,CADD,E,CAKA;;AACAxB,GAAG,CAACS,GAAJ,CACC,qBAAO,KAAP,EAAc;AACbQ,EAAAA,IAAI,EAAE,cAACC,GAAD,EAAeC,GAAf,EAAiC;AACtC,WAAOA,GAAG,CAACC,UAAJ,GAAiB,GAAxB;AACA,GAHY;AAIbC,EAAAA,MAAM,EAAEpB,OAAO,CAACwB;AAJH,CAAd,CADD,E,CASA;AACA;AACA;AACA;AACA;AACA;;AAGAzB,GAAG,CAACS,GAAJ,CAAQ,OAAR,EAAiBiB,aAAjB;;AAEArB,OAAO,CAAC,gBAAD,CAAP,C,CAEA;;;AACAL,GAAG,CAACS,GAAJ,CAAQ,UAAUkB,KAAV,EAAwBT,GAAxB,EAAsCC,GAAtC,EAAqDS,IAArD,EAAyE;AAChF,MAAID,KAAK,IAAI1B,OAAO,CAACC,GAAR,CAAYC,QAAZ,KAAyB,YAAlC,IAAkD,CAACgB,GAAG,CAACU,WAA3D,EAAwE;AACvE,QAAMC,KAAK,GAAG,IAAIC,cAAJ,CAAUJ,KAAV,EAAiBT,GAAjB,CAAd;AAEA,WAAOY,KAAK,CAACE,MAAN,GAAeC,IAAf,CAAoB,UAACC,IAAD;AAAA,aAAUf,GAAG,CAACgB,MAAJ,CAAW,GAAX,EAAgBvB,GAAhB,CAAoB,cAApB,EAAoC,WAApC,EAAiDwB,IAAjD,CAAsDF,IAAtD,CAAV;AAAA,KAApB,CAAP;AACA;;AACDN,EAAAA,IAAI,CAACD,KAAD,CAAJ;AACA,CAPD;AASA3B,GAAG,CAACqC,MAAJ,CAAW3B,IAAX,EAAiB,YAAY;AAC5BH,kBAAOC,IAAP,CAAY,sCAAsCE,IAAlD;;AACAH,kBAAOC,IAAP,CAAY,kBAAkBP,OAAO,CAACC,GAAR,CAAYoC,SAA1C;AACA,CAHD","sourcesContent":["import express, { NextFunction } from \"express\";\r\nimport { Request, Response } from \"express\";\r\n\r\nimport * as path from \"path\";\r\n\r\nimport * as fs from \"fs\";\r\n\r\nimport cookieParser from \"cookie-parser\";\r\n\r\nimport logger from \"./logger\";\r\nimport morgan from \"morgan\";\r\n\r\nimport * as dotenv from \"dotenv\";\r\ndotenv.config();\r\n\r\n// require(\"dotenv\").config();\r\n\r\nconst app = express();\r\nexport default app;\r\n\r\nif (process.env.NODE_ENV !== \"production\") {\r\n\tconst reloadify = require(\"@skandasoft/reloadify\")(__dirname);\r\n\tlogger.info(\"DIR Name\" + __dirname);\r\n\tapp.use(reloadify);\r\n}\r\n\r\n// const Youch = require(\"youch\");\r\nimport { default as Youch } from \"youch\";\r\n\r\nconst port = process.env.PORT || 4040;\r\napp.set(\"view engine\", \"ejs\");\r\napp.set(\"views\", path.join(__dirname, \"/views\"));\r\napp.use(express.static(\"public\"));\r\n\r\napp.use(cookieParser());\r\n\r\n// log only 4xx and 5xx responses to console\r\napp.use(\r\n\tmorgan(\"dev\", {\r\n\t\tskip: function (req, res) {\r\n\t\t\treturn res.statusCode < 400;\r\n\t\t},\r\n\t})\r\n);\r\n\r\n// log all requests to access.log\r\napp.use(\r\n\tmorgan(\"combined\", {\r\n\t\tstream: fs.createWriteStream(path.join(__dirname, \"../logs/access.log\"), { flags: \"a\" }),\r\n\t})\r\n);\r\n// show on console -> method/sub url/time taken\r\napp.use(\r\n\tmorgan(\"dev\", {\r\n\t\tskip: (req: Request, res: Response) => {\r\n\t\t\treturn res.statusCode > 400;\r\n\t\t},\r\n\t\tstream: process.stdout,\r\n\t})\r\n);\r\n\r\n// reloadify will not work\r\n// app.get(\"/\", (req: Request, res: Response) => {\r\n// \tres.status(200).send({\r\n// \t\tmessage: \"Hello Worlds!!!!\",\r\n// \t});\r\n// });\r\n\r\nimport dogs from \"./routes/dogs\";\r\napp.use(\"/dogs\", dogs);\r\n\r\nrequire(\"./routes/index\");\r\n\r\n// Then add some custom handling logic\r\napp.use(function (error: Error, req: Request, res: Response, next: NextFunction) {\r\n\tif (error && process.env.NODE_ENV !== \"production\" && !res.headersSent) {\r\n\t\tconst youch = new Youch(error, req);\r\n\r\n\t\treturn youch.toHTML().then((html) => res.status(500).set(\"Content-Type\", \"text/html\").send(html));\r\n\t}\r\n\tnext(error);\r\n});\r\n\r\napp.listen(port, function () {\r\n\tlogger.info(\"Express server listening on port \" + port);\r\n\tlogger.info(\"Log level is \" + process.env.LOG_LEVEL);\r\n});\r\n"],"file":"app.js"}